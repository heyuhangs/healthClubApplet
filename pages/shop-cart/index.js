var wanzikun_0x46c8 = ['NpHxE', 'navigateToPayOrder', 'NIzwJ', 'DMCUU', 'bjdLz', 'IyuIf', 'saveHidden', 'filter', 'wEgJM', ' 商品已失效，请重新购买', 'oUMvW', 'nEbVO', 'NUaEt', 'Ghjun', 'KRmBl', '/shop/goods/price', 'showLoading', 'vWhEi', 'Xgmxi', 'QHeqE', 'vxyLK', 'mYUNV', 'eQDrO', 'stores', 'OwHiw', 'price', 'showModal', 'ITzmh', 'iQxBs', 'propertyChildIds', 'LGRYB', 'YIRWi', 'Stjvz', 'EttgN', 'cRIfE', 'dbKrX', 'SYVHn', 'ZVPoH', 'dAbfj', 'properties', 'wJmqZ', 'HhWEa', 'GuLCV', 'EroPk', 'waOLy', 'bjRpg', 'nShao', 'NgaeK', 'VRytB', 'zwlIc', 'Llagq', 'pSSfZ', 'VkrPm', 'zYwLO', 'IVrLB', 'qJJWC', 'dkDhQ', 'Wketp', 'qyARk', 'arbFz', 'JtIzj', 'bVLnM', 'getSystemInfoSync', 'windowWidth', 'mMEwV', 'gsXte', 'SGOrK', 'floor', 'getEleWidth', 'data', 'delBtnWidth', 'setData', 'navigateTo', '/pages/goods-details/index?id=', 'LeFDF', '2|4|3|1|0|5', '/shop/goods/detail', 'iphone', '/config/get-value', 'shopcart', 'globalData', 'BmcKe', 'request', 'fqVWD', 'urls', 'lvPim', 'BBRsI', 'pylHD', 'NGGMS', 'XcLTx', 'ZCIsh', 'code', 'value', 'split', 'mSqVs', 'MTWoF', 'Sqpom', 'YIphS', 'dataset', 'index', 'phUeR', 'changedTouches', 'length', 'qMNEZ', 'goodsList', 'list', 'tJSQv', 'VVoEV', 'knYzV', 'margin-left:-', 'FIpKV', 'startX', 'mXoCF', 'left', 'getSaveHide', 'totalPrice', 'allSelect', 'noSelect', 'wnWAP', 'push', 'basicInfo', 'onShow', 'TgWYI', 'XNlaM', 'shopCarInfo', '/order/statistics', 'VGBpI', 'shopNum', 'XwPRn', 'KhHMl', 'setTabBarBadge', 'TLCBQ', 'count_id_no_pay', 'removeTabBarBadge', 'UHrIm', 'vECiW', 'touches', 'clientX', 'PagSa', 'token', 'ifpoP', 'yDopw', 'ySlNh', 'hideLoading', 'getStorageSync', 'shopList', 'bEUiH', 'gvTRG', 'yzvJm', 'number', 'setStorage', 'oVgMz', 'setGoodsList', 'switchTab', 'HGOYK', 'dJrby', 'BFMXd', 'MCiAi', 'left:-', 'currentTarget', 'idqCx', 'bnxuO', 'pfqlz', 'jFlWL', 'Wzxel', 'margin-left:0px', 'TGxLc', 'marQU', 'PKNPN', 'qAHdY', 'FQpNL', 'RWRTF', 'aJWUM', 'XNbXv', 'loawh', 'rngQX', 'eozRO', '0|4|5|1|2|3', 'QqVSz', 'mXffN', 'geIDm', 'wTopL', 'GtYvP', 'xrHWn', 'Rutqb', 'biCTT', 'RBAex', 'splice', 'diDBi', 'tEYiD', 'CcDLX', 'uxsfi', 'DPvZv', 'active', 'VIYSA', 'lmbhs', 'NFmXw', 'ApLHO', 'tSSOU', 'dBKkb', 'YNPsG', 'toFixed', 'GuVMA', 'FnFeZ', 'txpfd', 'gFGXx', 'wOlqO', 'SMbRq', 'DbeDp', 'rVGhR', 'hRDtP', 'wDfJX', 'pdtbx', 'eKNhA', 'AjOCp', 'ZKPEY', 'RCxTg', 'jcqLt', 'kAtZC', ' 价格有调整，请重新购买', 'Fuhnq', 'LirNk', 'JyPis', 'lxsgc', 'XkIpU', 'ewbDb', 'xeSbJ', 'name', 'ERDsY', 'ATDUa', 'QCXqu', 'muXJQ', 'gaBbS', 'ZpDlq', 'WUYlp', 'bAkha', 'GnHpd', 'EmOMf', 'nucxi', 'liXiH', 'QPjAA', 'EwLTy', 'GIUDI', 'QCICr', 'dUTMi'];
// (function (_0x3d0d8d, _0x557386) {
//     var _0x5d0947 = function (_0x1fdf21) {
//         while (--_0x1fdf21) {
//             _0x3d0d8d['push'](_0x3d0d8d['shift']());
//         }
//     };
//     _0x5d0947(++_0x557386);
// }(wanzikun_0x46c8, 0x130));
// var wanzikun_0x33f2 = function (_0x3a0699, _0x15c2d8) {
//     _0x3a0699 = _0x3a0699 - 0x0;
//     var _0x55ecfd = wanzikun_0x46c8[_0x3a0699];
//     return _0x55ecfd;
// };
// var wanzikun_0x3b814e = getApp();
const app = getApp();

// const {$Toast} = require('../../dist/base/index.js');

Page({
    'data': {
        // 'goodsList': {
        //     'saveHidden': !![],
        //     'totalPrice': 0x0,
        //     'allSelect': !![],
        //     'noSelect': ![],
        //     'list': [],
        // },
        hostGoodsList: [],
        allSelect: false,
        goodsList: [],
        sales: [{
            "barCode": "",
            "categoryId": 10450,
            "characteristic": "全场模版使用优惠券立减88元",
            "commission": 0,
            "commissionType": 0,
            "dateAdd": "2018-04-19 13:02:49",
            "dateStart": "2018-04-19 12:57:19",
            "dateUpdate": "2019-05-24 11:31:42",
            "gotScore": 0,
            "gotScoreType": 0,
            "id": 43223,
            "kanjia": false,
            "kanjiaPrice": 0,
            "logisticsId": 1273,
            "minPrice": 299,
            "minScore": 0,
            "name": "清欢素雅小程序端模版（API工厂授权版）",
            "numberFav": 81,
            "numberGoodReputation": 30,
            "numberOrders": 264,
            "numberSells": 13,
            "originalPrice": 550,
            "paixu": 0,
            "pic": "https://cdn.it120.cc/apifactory/2018/04/18/14569682d80bf52cd8ff4c3c116758a7.png",
            "pingtuan": false,
            "pingtuanPrice": 289,
            "propertyIds": ",5420,",
            "recommendStatus": 1,
            "recommendStatusStr": "推荐",
            "shopId": 755,
            "status": 0,
            "statusStr": "上架",
            "stores": 92,
            "userId": 797,
            "videoId": "",
            "views": 35141,
            "weight": 0
        }, {
            "barCode": "",
            "categoryId": 10450,
            "characteristic": "全场模版使用优惠券立减88元",
            "commission": 0,
            "commissionType": 0,
            "dateAdd": "2018-04-12 00:00:00",
            "dateStart": "2018-04-12 00:00:00",
            "dateUpdate": "2019-05-24 11:31:42",
            "gotScore": 0,
            "gotScoreType": 0,
            "id": 40601,
            "kanjia": false,
            "kanjiaPrice": 0,
            "logisticsId": 1273,
            "minPrice": 399,
            "minScore": 0,
            "name": "清欢食光机Plus小程序端模版（API工厂授权版）",
            "numberFav": 62,
            "numberGoodReputation": 3,
            "numberOrders": 270,
            "numberSells": 2,
            "originalPrice": 999,
            "paixu": 0,
            "pic": "https://cdn.it120.cc/apifactory/2018/04/12/42c001a698072b3bae9ac71f65ca2cfc.jpg",
            "pingtuan": false,
            "pingtuanPrice": 389,
            "propertyIds": ",5420,",
            "recommendStatus": 1,
            "recommendStatusStr": "推荐",
            "shopId": 755,
            "status": 0,
            "statusStr": "上架",
            "stores": 100,
            "userId": 797,
            "videoId": "",
            "views": 32301,
            "weight": 0
        }, {
            "barCode": "",
            "categoryId": 10450,
            "characteristic": "全场模版使用优惠券立减88元",
            "commission": 10,
            "commissionType": 0,
            "dateAdd": "2018-03-15 00:00:00",
            "dateStart": "2018-03-15 00:00:00",
            "dateUpdate": "2019-05-24 11:31:42",
            "gotScore": 0,
            "gotScoreType": 0,
            "id": 30164,
            "kanjia": false,
            "kanjiaPrice": 0,
            "logisticsId": 1273,
            "minPrice": 299,
            "minScore": 0,
            "name": "清欢严选商城小程序端模版（API工厂授权版）",
            "numberFav": 258,
            "numberGoodReputation": 184,
            "numberOrders": 409,
            "numberSells": 73,
            "originalPrice": 699,
            "paixu": 0,
            "pic": "https://cdn.it120.cc/apifactory/2018/05/19/84833eee6df34fa550cd7644b2242cf5.png",
            "pingtuan": true,
            "pingtuanPrice": 289,
            "propertyIds": ",5420,3688,",
            "recommendStatus": 1,
            "recommendStatusStr": "推荐",
            "shopId": 755,
            "status": 0,
            "statusStr": "上架",
            "stores": 100,
            "userId": 797,
            "videoId": "",
            "views": 79437,
            "weight": 0
        }, {
            "barCode": "",
            "categoryId": 10450,
            "characteristic": "全场模版使用优惠券立减88元",
            "commission": 10,
            "commissionType": 0,
            "dateAdd": "2018-03-15 00:00:00",
            "dateStart": "2018-03-15 00:00:00",
            "dateUpdate": "2019-05-24 11:31:42",
            "gotScore": 0,
            "gotScoreType": 0,
            "id": 30164,
            "kanjia": false,
            "kanjiaPrice": 0,
            "logisticsId": 1273,
            "minPrice": 299,
            "minScore": 0,
            "name": "清欢严选商城小程序端模版（API工厂授权版）",
            "numberFav": 258,
            "numberGoodReputation": 184,
            "numberOrders": 409,
            "numberSells": 73,
            "originalPrice": 699,
            "paixu": 0,
            "pic": "https://cdn.it120.cc/apifactory/2018/05/19/84833eee6df34fa550cd7644b2242cf5.png",
            "pingtuan": true,
            "pingtuanPrice": 289,
            "propertyIds": ",5420,3688,",
            "recommendStatus": 1,
            "recommendStatusStr": "推荐",
            "shopId": 755,
            "status": 0,
            "statusStr": "上架",
            "stores": 100,
            "userId": 797,
            "videoId": "",
            "views": 79437,
            "weight": 0
        }],
        'delBtnWidth': 0x78
    },
    'getEleWidth': function (_0x3039e0) {
        var _0x54213b = {
            'JtIzj': function (_0x4282cc, _0x3386a9) {
                return _0x4282cc !== _0x3386a9;
            },
            'bVLnM': wanzikun_0x33f2('0x0'),
            'mMEwV': function (_0x4e2313, _0xfd132f) {
                return _0x4e2313 / _0xfd132f;
            },
            'gsXte': function (_0x578fcc, _0x2b752c) {
                return _0x578fcc / _0x2b752c;
            },
            'SGOrK': function (_0x5ca047, _0x5dc93f) {
                return _0x5ca047 / _0x5dc93f;
            }
        };
        var _0x1dc157 = 0x0;
        try {
            if (_0x54213b[wanzikun_0x33f2('0x1')](_0x54213b[wanzikun_0x33f2('0x2')], 'YuykA')) {
                var _0x4c3930 = wx[wanzikun_0x33f2('0x3')]()[wanzikun_0x33f2('0x4')];
                var _0x1ff333 = _0x54213b[wanzikun_0x33f2('0x5')](_0x54213b[wanzikun_0x33f2('0x6')](0x2ee, 0x2), _0x54213b[wanzikun_0x33f2('0x7')](_0x3039e0, 0x2));
                _0x1dc157 = Math[wanzikun_0x33f2('0x8')](_0x54213b['SGOrK'](_0x4c3930, _0x1ff333));
                return _0x1dc157;
            } else {
                return ![];
            }
        } catch (_0x1b530e) {
            return ![];
        }
    },
    'initEleWidth': function () {
        var _0x47a6e8 = this[wanzikun_0x33f2('0x9')](this[wanzikun_0x33f2('0xa')][wanzikun_0x33f2('0xb')]);
        this[wanzikun_0x33f2('0xc')]({
            'delBtnWidth': _0x47a6e8
        });
    },
    'toDetailsTap': function (e) {
        this.data.isOnLoad = false;
        wx.navigateTo({
            url: `/pages/goods-details/index?id=${e.currentTarget.dataset.id}`
        })
    },
    onLoad: function () {
        this.data.isOnLoad = true;
        // this.data.isRunOnShow = true;
        const shopCarList = wx.getStorageSync('shopCar');
        if (shopCarList.length > 0) {
            this.setData({
                goodsList: shopCarList
            });
            this.isAllSelect();
            this.countPay();
        }
        this.getGoodsList();
    },
    onShow: function () {
        if (!this.data.isOnLoad) {
            this.onLoad();
        }
    },
    getGoodsList: function () {
        const self = this;
        wx.request({
            url: app.globalData.url + `goodImpl/hotGoodList?USER_ID=${app.globalData.userInfo.USER_ID}`,
            method: "GET",
            success: function (res) {
                if (res.statusCode == 200) {
                    self.setData({
                        hostGoodsList: res.data.goodList
                    })
                }
            }
        });
    },
    countPay: function () {
        let countPay = 0;
        for (const item of this.data.goodsList) {
            if (item.active) {
                countPay += item.buyNumber * item.goodsDetail.PRICE
            }
        }
        this.setData({
            countPay: countPay
        });
    },
    toPayOrder: function () {
        if (!this.data.goodsList.length) {
            wx.showToast({
                title: '您还没有选择商品哦!',
                icon: 'none',
                duration: 1000,
                mask: true
            })
            return false
        }
        for (const item of this.data.goodsList) {
            if (item.active) {
                this.data.isOnLoad = false;
                wx.navigateTo({
                    url: '/pages/to-pay-order/index',
                });
                return false;
            }
        }
        wx.showToast({
            title: '您还没有选择商品哦!',
            icon: 'none',
            duration: 1000,
            mask: true
        })
    },
    selectTap: function (e) {
        // const key = `this.data.goodsList[0].active`;
        // var up = "info[" + 0 + "].gMoney";
        // this.setData({
        //     key: false
        // })
    },
    touchE: function (e) {
        const key = "goodsList[" + e.currentTarget.dataset.index + "].active";
        const status = !this.data.goodsList[e.currentTarget.dataset.index].active;
        this.setData({
            [key]: status
        });
        this.isAllSelect();
        this.countPay();
    },
    onHide: function () {
        wx.setStorage({
            key: 'shopCar',
            data: this.data.goodsList,
            success: function (res) {
            }
        });
    },
    jiaBtnTap: function (e) {
        const key = "goodsList[" + e.currentTarget.dataset.index + "].buyNumber";
        if (this.data.goodsList[e.currentTarget.dataset.index].buyNumber == 99) {
            return false
        }
        const num = ++this.data.goodsList[e.currentTarget.dataset.index].buyNumber;
        this.setData({
            [key]: num
        });
        this.countPay();
        return false;
    },
    jianBtnTap: function (e) {
        const key = "goodsList[" + e.currentTarget.dataset.index + "].buyNumber";
        if (this.data.goodsList[e.currentTarget.dataset.index].buyNumber == 1) {
            return false
        }
        const num = --this.data.goodsList[e.currentTarget.dataset.index].buyNumber;
        this.setData({
            [key]: num
        });
        this.countPay();
        return false;
    },
    bindAllSelect: function () {
        let status = true;
        if (this.data.allSelect) {
            status = false
        } else {
            status = true
        }
        for (const ind in this.data.goodsList) {
            const key = "goodsList[" + ind + "].active";
            this.setData({
                [key]: status
            })
        }
        this.countPay();
        this.setData({
            allSelect: status
        });
    },
    isAllSelect: function () {
        let status = 0;
        for (const item of this.data.goodsList) {
            if (item.active) {
                ++status;
            }
        }
        if (this.data.goodsList.length == status) {
            this.setData({
                allSelect: true
            });
        } else {
            this.setData({
                allSelect: false
            });
        }
    },
    delItem: function (e) {
        this.setData({
            isDel: true,
            isDelIdx: e.currentTarget.dataset.index
        })
    },
    handleDel: function () {
        this.data.goodsList.splice(this.data.isDelIdx, 1);
        this.setData({
            isDel: false,
            goodsList: this.data.goodsList
        });
    },
    handleNoDel: function () {
        this.setData({
            isDel: false
        });
    },
    'toIndexPage': function () {
        var _0x342203 = {
            'HGOYK': '/pages/index/index'
        };
        wx[wanzikun_0x33f2('0x5e')]({
            'url': _0x342203[wanzikun_0x33f2('0x5f')]
        });
    },
    // 'touchS': function (_0x5ef5fb) {
    //     var _0x3d6e97 = {
    //         'dJrby': function (_0x55c4ac, _0x595cb1) {
    //             return _0x55c4ac == _0x595cb1;
    //         }
    //     };
    //     if (_0x3d6e97[wanzikun_0x33f2('0x60')](_0x5ef5fb[wanzikun_0x33f2('0x4d')][wanzikun_0x33f2('0x2b')], 0x1)) {
    //         this[wanzikun_0x33f2('0xc')]({
    //             'startX': _0x5ef5fb[wanzikun_0x33f2('0x4d')][0x0]['clientX']
    //         });
    //     }
    // },
    'totalPrice': function () {
        var _0x2f9998 = {
            'lmbhs': function (_0x9f7ab0, _0x4f7d1d) {
                return _0x9f7ab0 < _0x4f7d1d;
            },
            'NFmXw': function (_0x219710, _0x351920) {
                return _0x219710 === _0x351920;
            },
            'ApLHO': wanzikun_0x33f2('0x87'),
            'dBKkb': function (_0x2c2254, _0x3a1342) {
                return _0x2c2254 * _0x3a1342;
            },
            'YNPsG': function (_0xe1b5cb, _0x1f025a) {
                return _0xe1b5cb(_0x1f025a);
            }
        };
        var _0x58e266 = this[wanzikun_0x33f2('0xa')][wanzikun_0x33f2('0x2d')][wanzikun_0x33f2('0x2e')];
        var _0xc762df = 0x0;
        for (var _0x42cc90 = 0x0; _0x2f9998[wanzikun_0x33f2('0x88')](_0x42cc90, _0x58e266[wanzikun_0x33f2('0x2b')]); _0x42cc90++) {
            var _0x3c3070 = _0x58e266[_0x42cc90];
            if (_0x3c3070['active']) {
                if (_0x2f9998[wanzikun_0x33f2('0x89')](_0x2f9998[wanzikun_0x33f2('0x8a')], wanzikun_0x33f2('0x8b'))) {
                    for (var _0x2ad7f6 = 0x0; _0x2f9998[wanzikun_0x33f2('0x88')](_0x2ad7f6, _0x58e266[wanzikun_0x33f2('0x2b')]); _0x2ad7f6++) {
                        var _0x4d1187 = _0x58e266[_0x2ad7f6];
                        _0x4d1187['active'] = ![];
                    }
                } else {
                    _0xc762df += _0x2f9998[wanzikun_0x33f2('0x8c')](_0x2f9998[wanzikun_0x33f2('0x8d')](parseFloat, _0x3c3070['price']), _0x3c3070[wanzikun_0x33f2('0x5a')]);
                }
            }
        }
        _0xc762df = _0x2f9998[wanzikun_0x33f2('0x8d')](parseFloat, _0xc762df[wanzikun_0x33f2('0x8e')](0x2));
        return _0xc762df;
    },
    'navigateToPayOrder': function () {
        var _0x26510b = {
            'qyARk': '/pages/to-pay-order/index'
        };
        wx[wanzikun_0x33f2('0x54')]();
        wx['navigateTo']({
            'url': _0x26510b[wanzikun_0x33f2('0xf4')]
        });
    }
});
